<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-11-09T13:22:59.1911082"><title>üîí Securing the API Endpoints | AWS Serverless Workshop</title><script type="application/json" id="virtual-toc-data">[{"id":"step-by-step-adding-api-key-authentication","level":0,"title":"üìú Step-by-Step: Adding API Key Authentication","anchor":"#step-by-step-adding-api-key-authentication"},{"id":"understanding-the-components","level":0,"title":"üîç Understanding the Components","anchor":"#understanding-the-components"},{"id":"enforcing-api-key-requirement-on-endpoints","level":0,"title":"üîê Enforcing API Key Requirement on Endpoints","anchor":"#enforcing-api-key-requirement-on-endpoints"},{"id":"testing-and-deployment","level":0,"title":"üß™ Testing and Deployment","anchor":"#testing-and-deployment"},{"id":"congratulations","level":0,"title":"üéâ Congratulations!","anchor":"#congratulations"},{"id":"additional-resources","level":0,"title":"üìö Additional Resources","anchor":"#additional-resources"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="üîí Securing the API Endpoints | AWS Serverless Workshop"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="AWS Serverless Workshop Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation//1/adding-api-key.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="üîí Securing the API Endpoints | AWS Serverless Workshop"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation//1/adding-api-key.html#webpage",
    "url": "writerside-documentation//1/adding-api-key.html",
    "name": "üîí Securing the API Endpoints | AWS Serverless Workshop",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "AWS Serverless Workshop Help"
}</script><!-- End Schema.org --></head><body data-id="Adding-API-Key" data-main-title="üîí Securing the API Endpoints" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="main.md|Introduction"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>AWS Serverless Workshop 1 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Adding-API-Key" id="Adding-API-Key.md">üîí Securing the API Endpoints</h1><p id="-qr320o_3"><span class="control" id="-qr320o_11">Now that our API endpoints are up and running, it's important to secure them to prevent unauthorized access. We'll add API Key Authentication to our API Gateway so that only clients with a valid API key can interact with our todo items.</span></p><section class="chapter"><h2 id="step-by-step-adding-api-key-authentication" data-toc="step-by-step-adding-api-key-authentication">üìú Step-by-Step: Adding API Key Authentication</h2><section class="chapter"><h3 id="1-create-an-api-key" data-toc="1-create-an-api-key">1. <span class="control" id="-qr320o_22">Create an API Key</span></h3><ul class="list _bullet" id="-qr320o_17"><li class="list__item" id="-qr320o_23"><p><span class="control" id="-qr320o_25">What is an API Key?</span></p><ul class="list _bullet" id="-qr320o_26"><li class="list__item" id="-qr320o_27"><p>An API key is like a password that clients must include with their requests to access your API.</p></li></ul></li><li class="list__item" id="-qr320o_24"><p><span class="control" id="-qr320o_28">Why use it?</span></p><ul class="list _bullet" id="-qr320o_29"><li class="list__item" id="-qr320o_30"><p>It helps control who can use your API and can prevent unauthorized or excessive use.</p></li></ul></li></ul><p id="-qr320o_18"><span class="control" id="-qr320o_31">How to create an API Key in CDK:</span></p><div class="code-block" data-lang="ts">
const apiKey = api.addApiKey('TodoApiKey', {
  apiKeyName: 'todo-api-key',
});
</div><ul class="list _bullet" id="-qr320o_20"><li class="list__item" id="-qr320o_32"><p><span class="control" id="-qr320o_33">Explanation:</span></p><ul class="list _bullet" id="-qr320o_34"><li class="list__item" id="-qr320o_35"><p><code class="code" id="-qr320o_37">api.addApiKey</code>: Adds a new API key to your API Gateway.</p></li><li class="list__item" id="-qr320o_36"><p><code class="code" id="-qr320o_38">apiKeyName</code>: A friendly name for your API key.</p></li></ul></li></ul><p id="-qr320o_21"><span class="control" id="-qr320o_39">Note:</span> It's best practice to let AWS generate the API key for you by not specifying the <code class="code" id="-qr320o_40">value</code> property. This ensures the key is securely generated.</p></section><section class="chapter"><h3 id="2-define-a-usage-plan" data-toc="2-define-a-usage-plan">2. <span class="control" id="-qr320o_46">Define a Usage Plan</span></h3><ul class="list _bullet" id="-qr320o_42"><li class="list__item" id="-qr320o_47"><p><span class="control" id="-qr320o_49">What is a Usage Plan?</span></p><ul class="list _bullet" id="-qr320o_50"><li class="list__item" id="-qr320o_51"><p>It sets limits on how often the API can be called using a particular API key.</p></li></ul></li><li class="list__item" id="-qr320o_48"><p><span class="control" id="-qr320o_52">Why use it?</span></p><ul class="list _bullet" id="-qr320o_53"><li class="list__item" id="-qr320o_54"><p>To prevent abuse and manage your API's performance.</p></li></ul></li></ul><p id="-qr320o_43"><span class="control" id="-qr320o_55">How to define a Usage Plan:</span></p><div class="code-block" data-lang="ts">
const usagePlan = api.addUsagePlan('TodoApiUsagePlan', {
  name: 'TodoApiUsagePlan',
  throttle: {
    rateLimit: 10,  // Max requests per second
    burstLimit: 20, // Max requests in a short burst
  },
  quota: {
    limit: 1000,                // Total requests allowed
    period: apigateway.Period.MONTH, // Timeframe for the quota
  },
});
</div><ul class="list _bullet" id="-qr320o_45"><li class="list__item" id="-qr320o_56"><p><span class="control" id="-qr320o_57">Explanation:</span></p><ul class="list _bullet" id="-qr320o_58"><li class="list__item" id="-qr320o_59"><p><code class="code" id="-qr320o_61">throttle</code>: Controls the rate at which requests are allowed.</p></li><li class="list__item" id="-qr320o_60"><p><code class="code" id="-qr320o_62">quota</code>: Sets a cap on the total number of requests over a period.</p></li></ul></li></ul></section><section class="chapter"><h3 id="3-attach-the-api-key-to-the-usage-plan" data-toc="3-attach-the-api-key-to-the-usage-plan">3. <span class="control" id="-qr320o_67">Attach the API Key to the Usage Plan</span></h3><ul class="list _bullet" id="-qr320o_64"><li class="list__item" id="-qr320o_68"><p><span class="control" id="-qr320o_69">Purpose:</span> Links the API key to the usage plan so the limits are enforced.</p></li></ul><p id="-qr320o_65"><span class="control" id="-qr320o_70">How to attach the API Key:</span></p><div class="code-block" data-lang="ts">
usagePlan.addApiKey(apiKey);
</div></section><section class="chapter"><h3 id="4-associate-the-usage-plan-with-api-stages" data-toc="4-associate-the-usage-plan-with-api-stages">4. <span class="control" id="-qr320o_76">Associate the Usage Plan with API Stages</span></h3><ul class="list _bullet" id="-qr320o_72"><li class="list__item" id="-qr320o_77"><p><span class="control" id="-qr320o_79">What is an API Stage?</span></p><ul class="list _bullet" id="-qr320o_80"><li class="list__item" id="-qr320o_81"><p>A stage represents a version of your API (like 'dev', 'prod').</p></li></ul></li><li class="list__item" id="-qr320o_78"><p><span class="control" id="-qr320o_82">Why associate it?</span></p><ul class="list _bullet" id="-qr320o_83"><li class="list__item" id="-qr320o_84"><p>So the usage plan applies to the correct version of your API.</p></li></ul></li></ul><p id="-qr320o_73"><span class="control" id="-qr320o_85">How to associate the Usage Plan:</span></p><div class="code-block" data-lang="ts">
usagePlan.addApiStage({
  stage: api.deploymentStage,
});
</div></section></section><section class="chapter"><h2 id="understanding-the-components" data-toc="understanding-the-components">üîç Understanding the Components</h2><section class="chapter"><h3 id="api-key" data-toc="api-key"><span class="control" id="-qr320o_90">API Key</span></h3><ul class="list _bullet" id="-qr320o_89"><li class="list__item" id="-qr320o_91"><p><span class="control" id="-qr320o_93">Analogy:</span> Think of an API key as a membership card that you show to gain access to a club.</p></li><li class="list__item" id="-qr320o_92"><p><span class="control" id="-qr320o_94">Role in our app:</span> Clients must present this key with each request to access the API.</p></li></ul></section><section class="chapter"><h3 id="usage-plan" data-toc="usage-plan"><span class="control" id="-qr320o_98">Usage Plan</span></h3><ul class="list _bullet" id="-qr320o_96"><li class="list__item" id="-qr320o_99"><p><span class="control" id="-qr320o_102">Analogy:</span> It's like setting rules for club members on how often they can visit.</p></li><li class="list__item" id="-qr320o_100"><p><span class="control" id="-qr320o_103">Throttle Limits:</span></p><ul class="list _bullet" id="-qr320o_104"><li class="list__item" id="-qr320o_105"><p><span class="control" id="-qr320o_107">Rate Limit:</span> Max number of requests per second.</p></li><li class="list__item" id="-qr320o_106"><p><span class="control" id="-qr320o_108">Burst Limit:</span> Max number of requests allowed in a short time.</p></li></ul></li><li class="list__item" id="-qr320o_101"><p><span class="control" id="-qr320o_109">Quota Limits:</span></p><ul class="list _bullet" id="-qr320o_110"><li class="list__item" id="-qr320o_111"><p><span class="control" id="-qr320o_113">Limit:</span> Total number of requests allowed in a period (e.g., per month).</p></li><li class="list__item" id="-qr320o_112"><p><span class="control" id="-qr320o_114">Period:</span> The time frame for the quota.</p></li></ul></li></ul></section></section><section class="chapter"><h2 id="enforcing-api-key-requirement-on-endpoints" data-toc="enforcing-api-key-requirement-on-endpoints">üîê Enforcing API Key Requirement on Endpoints</h2><p id="-qr320o_115">To require an API key for your endpoints, you need to update each method to enforce it.</p><section class="chapter"><h3 id="update-your-methods-to-require-an-api-key" data-toc="update-your-methods-to-require-an-api-key"><span class="control" id="-qr320o_121">Update Your Methods to Require an API Key</span></h3><div class="code-block" data-lang="ts">
// Enforce API Key on POST /todos
todos.addMethod('POST', createTodoIntegration, {
  apiKeyRequired: true,
});

// Enforce API Key on GET /todos
todos.addMethod('GET', getTodosIntegration, {
  apiKeyRequired: true,
});

// For /todos/{id} resource
const todo = todos.addResource('{id}');

// Enforce API Key on GET /todos/{id}
todo.addMethod('GET', getTodoIntegration, {
  apiKeyRequired: true,
});

// Enforce API Key on PATCH /todos/{id}
todo.addMethod('PATCH', updateTodoIntegration, {
  apiKeyRequired: true,
});

// Enforce API Key on DELETE /todos/{id}
todo.addMethod('DELETE', deleteTodoIntegration, {
  apiKeyRequired: true,
});
</div><ul class="list _bullet" id="-qr320o_119"><li class="list__item" id="-qr320o_122"><p><span class="control" id="-qr320o_123">Explanation:</span></p><ul class="list _bullet" id="-qr320o_124"><li class="list__item" id="-qr320o_125"><p>Adding <code class="code" id="-qr320o_126">apiKeyRequired: true</code> to each method tells API Gateway that a valid API key must be provided to access these endpoints.</p></li></ul></li></ul></section></section><section class="chapter"><h2 id="testing-and-deployment" data-toc="testing-and-deployment">üß™ Testing and Deployment</h2><section class="chapter"><h3 id="1-synthesize-the-cloudformation-template" data-toc="1-synthesize-the-cloudformation-template">1. <span class="control" id="-qr320o_132">Synthesize the CloudFormation Template</span></h3><ul class="list _bullet" id="-qr320o_131"><li class="list__item" id="-qr320o_133"><p id="-qr320o_135"><span class="control" id="-qr320o_137">Command:</span></p><div class="code-block" data-lang="bash">
cdk synth
</div></li><li class="list__item" id="-qr320o_134"><p id="-qr320o_138"><span class="control" id="-qr320o_139">Purpose:</span> To preview the AWS resources that will be created or updated.</p></li></ul></section><section class="chapter"><h3 id="2-deploy-the-stack" data-toc="2-deploy-the-stack">2. <span class="control" id="-qr320o_142">Deploy the Stack</span></h3><ul class="list _bullet" id="-qr320o_141"><li class="list__item" id="-qr320o_143"><p id="-qr320o_145"><span class="control" id="-qr320o_147">Command:</span></p><div class="code-block" data-lang="bash">
cdk deploy
</div></li><li class="list__item" id="-qr320o_144"><p id="-qr320o_148"><span class="control" id="-qr320o_149">Note:</span> Confirm the deployment when prompted.</p></li></ul></section><section class="chapter"><h3 id="3-testing-the-api-key-requirement" data-toc="3-testing-the-api-key-requirement">3. <span class="control" id="-qr320o_154">Testing the API Key Requirement</span></h3><section class="chapter"><h4 id="a-retrieve-the-generated-api-key" data-toc="a-retrieve-the-generated-api-key">a. <span class="control" id="-qr320o_157">Retrieve the Generated API Key</span></h4><ul class="list _bullet" id="-qr320o_156"><li class="list__item" id="-qr320o_158"><p><span class="control" id="-qr320o_161">Go to the API Gateway Console:</span></p><ul class="list _bullet" id="-qr320o_162"><li class="list__item" id="-qr320o_163"><p>Navigate to your API and find the API Keys section.</p></li></ul></li><li class="list__item" id="-qr320o_159"><p><span class="control" id="-qr320o_164">Find your API Key:</span></p><ul class="list _bullet" id="-qr320o_165"><li class="list__item" id="-qr320o_166"><p>Look for the <code class="code" id="-qr320o_167">todo-api-key</code>.</p></li></ul></li><li class="list__item" id="-qr320o_160"><p><span class="control" id="-qr320o_168">Copy the API Key Value:</span></p><ul class="list _bullet" id="-qr320o_169"><li class="list__item" id="-qr320o_170"><p><span class="control" id="-qr320o_171">Important:</span> Copy it now; you won't be able to see it again later.</p></li></ul></li></ul></section><section class="chapter"><h4 id="b-send-a-request-with-the-api-key" data-toc="b-send-a-request-with-the-api-key">b. <span class="control" id="-qr320o_174">Send a Request with the API Key</span></h4><ul class="list _bullet" id="-qr320o_173"><li class="list__item" id="-qr320o_175"><p id="-qr320o_178"><span class="control" id="-qr320o_180">Use Tools Like:</span></p><ul class="list _bullet" id="-qr320o_179"><li class="list__item" id="-qr320o_181"><p><span class="control" id="-qr320o_183">Postman</span></p></li><li class="list__item" id="-qr320o_182"><p><span class="control" id="-qr320o_184">curl</span></p></li></ul></li><li class="list__item" id="-qr320o_176"><p id="-qr320o_185"><span class="control" id="-qr320o_188">Sample Request Using <code class="code" id="-qr320o_189">curl</code>:</span></p><div class="code-block" data-lang="bash">
curl -H &quot;x-api-key: YOUR_API_KEY_VALUE&quot; -X GET https://your-api-id.execute-api.your-region.amazonaws.com/prod/todos
</div><ul class="list _bullet" id="-qr320o_187"><li class="list__item" id="-qr320o_190"><p><span class="control" id="-qr320o_192">Replace <code class="code" id="-qr320o_193">YOUR_API_KEY_VALUE</code></span> with the API key you copied.</p></li><li class="list__item" id="-qr320o_191"><p><span class="control" id="-qr320o_194">Replace <code class="code" id="-qr320o_195">your-api-id</code> and <code class="code" id="-qr320o_196">your-region</code></span> with your actual API ID and region.</p></li></ul></li><li class="list__item" id="-qr320o_177"><p id="-qr320o_197"><span class="control" id="-qr320o_199">Expected Response:</span></p><ul class="list _bullet" id="-qr320o_198"><li class="list__item" id="-qr320o_200"><p><span class="control" id="-qr320o_202">Success:</span> You receive the data from your API.</p></li><li class="list__item" id="-qr320o_201"><p><span class="control" id="-qr320o_203">Failure:</span> Without the API key or with an incorrect one, you'll get a <code class="code" id="-qr320o_204">403 Forbidden</code> error.</p></li></ul></li></ul></section><section class="chapter"><h4 id="c-verify-api-key-enforcement" data-toc="c-verify-api-key-enforcement">c. <span class="control" id="-qr320o_208">Verify API Key Enforcement</span></h4><ul class="list _bullet" id="-qr320o_206"><li class="list__item" id="-qr320o_209"><p id="-qr320o_211"><span class="control" id="-qr320o_213">Test Without API Key:</span></p><div class="code-block" data-lang="bash">
curl -X GET https://your-api-id.execute-api.your-region.amazonaws.com/prod/todos
</div></li><li class="list__item" id="-qr320o_210"><p id="-qr320o_214"><span class="control" id="-qr320o_216">Expected Response:</span></p><ul class="list _bullet" id="-qr320o_215"><li class="list__item" id="-qr320o_217"><p><span class="control" id="-qr320o_218">Failure:</span> You'll receive a <code class="code" id="-qr320o_219">403 Forbidden</code> error, confirming that the API key is required.</p></li></ul></li></ul></section></section></section><section class="chapter"><h2 id="congratulations" data-toc="congratulations">üéâ Congratulations!</h2><p id="-qr320o_220"><span class="control" id="-qr320o_223">You've successfully secured your API endpoints with API Key Authentication!</span></p><ul class="list _bullet" id="-qr320o_221"><li class="list__item" id="-qr320o_224"><p><span class="control" id="-qr320o_225">What this means:</span></p><ul class="list _bullet" id="-qr320o_226"><li class="list__item" id="-qr320o_227"><p>Only clients with a valid API key can access your API.</p></li><li class="list__item" id="-qr320o_228"><p>You can control and monitor the usage of your API.</p></li></ul></li></ul></section><section class="chapter"><h2 id="additional-resources" data-toc="additional-resources">üìö Additional Resources</h2><ul class="list _bullet" id="-qr320o_229"><li class="list__item" id="-qr320o_230"><p><span class="control" id="-qr320o_234">Amazon API Gateway Documentation</span></p><ul class="list _bullet" id="-qr320o_235"><li class="list__item" id="-qr320o_236"><p><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/welcome.html" id="-qr320o_237" data-external="true" rel="noopener noreferrer">API Gateway Guide</a></p></li></ul></li><li class="list__item" id="-qr320o_231"><p><span class="control" id="-qr320o_238">AWS CDK API Gateway Module</span></p><ul class="list _bullet" id="-qr320o_239"><li class="list__item" id="-qr320o_240"><p><a href="https://docs.aws.amazon.com/cdk/api/latest/docs/aws-apigateway-readme.html" id="-qr320o_241" data-external="true" rel="noopener noreferrer">CDK API Gateway</a></p></li></ul></li><li class="list__item" id="-qr320o_232"><p><span class="control" id="-qr320o_242">Securing APIs with API Keys</span></p><ul class="list _bullet" id="-qr320o_243"><li class="list__item" id="-qr320o_244"><p><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-api-usage-plans.html" id="-qr320o_245" data-external="true" rel="noopener noreferrer">AWS Guide on API Keys</a></p></li></ul></li><li class="list__item" id="-qr320o_233"><p><span class="control" id="-qr320o_246">TypeScript Handbook</span></p><ul class="list _bullet" id="-qr320o_247"><li class="list__item" id="-qr320o_248"><p><a href="https://www.typescriptlang.org/docs/handbook/intro.html" id="-qr320o_249" data-external="true" rel="noopener noreferrer">TypeScript Docs</a></p></li></ul></li></ul></section><div class="last-modified">Last modified: 09 November 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="empty-md-topic.html" class="navigation-links__prev">üóëÔ∏è Creating `deleteTodo`</a><a href="full-code-integration.html" class="navigation-links__next">üèóÔ∏è Complete CDK Stack Code with API Key Authentication</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.js"></script></body></html>