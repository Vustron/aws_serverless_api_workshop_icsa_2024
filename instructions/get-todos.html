<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-11-09T13:22:59.120094"><title>üìã Creating `getTodos` | AWS Serverless Workshop</title><script type="application/json" id="virtual-toc-data">[{"id":"step-by-step-defining-the-gettodos-lambda-function","level":0,"title":"üìú Step-by-Step: Defining the getTodos Lambda Function","anchor":"#step-by-step-defining-the-gettodos-lambda-function"},{"id":"adding-gettodos-to-the-cdk-stack","level":0,"title":"‚ûï Adding getTodos to the CDK Stack","anchor":"#adding-gettodos-to-the-cdk-stack"},{"id":"testing-and-deployment","level":0,"title":"üß™ Testing and Deployment","anchor":"#testing-and-deployment"},{"id":"congratulations","level":0,"title":"üéâ Congratulations!","anchor":"#congratulations"},{"id":"additional-resources","level":0,"title":"üìö Additional Resources","anchor":"#additional-resources"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="üìã Creating `getTodos` | AWS Serverless Workshop"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="AWS Serverless Workshop Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation//1/get-todos.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="üìã Creating `getTodos` | AWS Serverless Workshop"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation//1/get-todos.html#webpage",
    "url": "writerside-documentation//1/get-todos.html",
    "name": "üìã Creating `getTodos` | AWS Serverless Workshop",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "AWS Serverless Workshop Help"
}</script><!-- End Schema.org --></head><body data-id="Get-Todos" data-main-title="üìã Creating `getTodos`" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="main.md|Introduction"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>AWS Serverless Workshop 1 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Get-Todos" id="Get-Todos.md">üìã Creating `getTodos`</h1><p id="r8tgng_4"><span class="control" id="r8tgng_12">Now that we've set up the <code class="code" id="r8tgng_13">createTodo</code> function to add items, let's create the <code class="code" id="r8tgng_14">getTodos</code> function to retrieve all todo items from our DynamoDB table. We'll use the AWS SDK for JavaScript version 3 (AWS SDK v3) to interact with DynamoDB.</span></p><section class="chapter"><h2 id="step-by-step-defining-the-gettodos-lambda-function" data-toc="step-by-step-defining-the-gettodos-lambda-function">üìú Step-by-Step: Defining the <code class="code" id="r8tgng_19">getTodos</code> Lambda Function</h2><section class="chapter"><h3 id="1-create-the-gettodos-ts-file" data-toc="1-create-the-gettodos-ts-file">1. <span class="control" id="r8tgng_22">Create the <code class="code" id="r8tgng_23">getTodos.ts</code> File</span></h3><ul class="list _bullet" id="r8tgng_21"><li class="list__item" id="r8tgng_24"><p id="r8tgng_26"><span class="control" id="r8tgng_27">What to do:</span> Create a new file for the <code class="code" id="r8tgng_28">getTodos</code> Lambda function.</p></li><li class="list__item" id="r8tgng_25"><p id="r8tgng_29"><span class="control" id="r8tgng_32">How:</span></p><p id="r8tgng_30">Open your terminal and navigate to the <code class="code" id="r8tgng_33">lambda</code> directory:</p><div class="code-block" data-lang="bash">
cd lambda
touch getTodos.ts
</div></li></ul></section><section class="chapter"><h3 id="2-write-the-lambda-function-code" data-toc="2-write-the-lambda-function-code">2. <span class="control" id="r8tgng_36">Write the Lambda Function Code</span></h3><ul class="list _bullet" id="r8tgng_35"><li class="list__item" id="r8tgng_37"><p id="r8tgng_38"><span class="control" id="r8tgng_40">Open <code class="code" id="r8tgng_41">getTodos.ts</code></span> in your code editor and add the following code:</p><div class="code-block" data-lang="ts">
// Import necessary AWS SDK v3 clients and commands
import { DynamoDBClient } from &quot;@aws-sdk/client-dynamodb&quot;;
import {
  DynamoDBDocumentClient,
  ScanCommand,
  ScanCommandInput,
} from &quot;@aws-sdk/lib-dynamodb&quot;;

// Define the interface for a Todo item
interface TodoItem {
  id: string;
  title: string;
  description: string;
  completed: boolean;
}

// Initialize the DynamoDB Client
const ddbClient = new DynamoDBClient({
  region: process.env.AWS_REGION, // Your AWS region
});

// Initialize the DynamoDB Document Client
const dynamoDb = DynamoDBDocumentClient.from(ddbClient);

export const handler = async () =&gt; {
  // Set up parameters for the Scan operation
  const params: ScanCommandInput = {
    TableName: process.env.TABLE_NAME!, // DynamoDB table name from environment variables
  };

  try {
    // Execute the ScanCommand to retrieve items
    const data = await dynamoDb.send(new ScanCommand(params));

    // Extract items from the response
    const items = data.Items as TodoItem[];

    return {
      statusCode: 200,
      body: JSON.stringify(items),
    };
  } catch (error) {
    console.error(&quot;Error retrieving todo items:&quot;, error);

    return {
      statusCode: 500,
      body: JSON.stringify({ error: &quot;Could not retrieve the todo items&quot; }),
    };
  }
};
</div></li></ul></section><section class="chapter"><h3 id="3-understanding-the-code" data-toc="3-understanding-the-code">3. <span class="control" id="r8tgng_48">Understanding the Code</span></h3><p id="r8tgng_43">Let's break down what this code does.</p><section class="chapter"><h4 id="a-imports" data-toc="a-imports">a. <span class="control" id="r8tgng_51">Imports</span></h4><ul class="list _bullet" id="r8tgng_50"><li class="list__item" id="r8tgng_52"><p><span class="control" id="r8tgng_53">AWS SDK v3 Modules:</span></p><ul class="list _bullet" id="r8tgng_54"><li class="list__item" id="r8tgng_55"><p><code class="code" id="r8tgng_57">DynamoDBClient</code>: Low-level client for DynamoDB operations.</p></li><li class="list__item" id="r8tgng_56"><p><code class="code" id="r8tgng_58">DynamoDBDocumentClient</code>, <code class="code" id="r8tgng_59">ScanCommand</code>, <code class="code" id="r8tgng_60">ScanCommandInput</code>: Simplifies interactions with DynamoDB by abstracting away some of the complexities.</p></li></ul></li></ul></section><section class="chapter"><h4 id="b-define-the-todoitem-interface" data-toc="b-define-the-todoitem-interface">b. <span class="control" id="r8tgng_63">Define the <code class="code" id="r8tgng_64">TodoItem</code> Interface</span></h4><ul class="list _bullet" id="r8tgng_62"><li class="list__item" id="r8tgng_65"><p><span class="control" id="r8tgng_67">Purpose:</span> Specifies the structure of a todo item, ensuring consistency.</p></li><li class="list__item" id="r8tgng_66"><p><span class="control" id="r8tgng_68">Fields:</span></p><ul class="list _bullet" id="r8tgng_69"><li class="list__item" id="r8tgng_70"><p><code class="code" id="r8tgng_74">id</code>: Unique identifier for the todo item.</p></li><li class="list__item" id="r8tgng_71"><p><code class="code" id="r8tgng_75">title</code>: Title of the todo.</p></li><li class="list__item" id="r8tgng_72"><p><code class="code" id="r8tgng_76">description</code>: Description of the todo.</p></li><li class="list__item" id="r8tgng_73"><p><code class="code" id="r8tgng_77">completed</code>: Boolean indicating if the todo is completed.</p></li></ul></li></ul></section><section class="chapter"><h4 id="c-initialize-the-dynamodb-clients" data-toc="c-initialize-the-dynamodb-clients">c. <span class="control" id="r8tgng_80">Initialize the DynamoDB Clients</span></h4><ul class="list _bullet" id="r8tgng_79"><li class="list__item" id="r8tgng_81"><p><span class="control" id="r8tgng_83"><code class="code" id="r8tgng_84">ddbClient</code>:</span> Configured with the AWS region, it communicates with DynamoDB.</p></li><li class="list__item" id="r8tgng_82"><p><span class="control" id="r8tgng_85"><code class="code" id="r8tgng_86">dynamoDb</code>:</span> A higher-level client that simplifies data conversion between DynamoDB and JavaScript objects.</p></li></ul></section><section class="chapter"><h4 id="d-the-handler-function" data-toc="d-the-handler-function">d. <span class="control" id="r8tgng_90">The Handler Function</span></h4><ul class="list _bullet" id="r8tgng_88"><li class="list__item" id="r8tgng_91"><p><span class="control" id="r8tgng_93">Purpose:</span> This is the function AWS Lambda executes when triggered.</p></li><li class="list__item" id="r8tgng_92"><p><span class="control" id="r8tgng_94">Process:</span></p><ul class="list _bullet" id="r8tgng_95"><li class="list__item" id="r8tgng_96"><p><span class="control" id="r8tgng_99">Set Up Parameters:</span></p><ul class="list _bullet" id="r8tgng_100"><li class="list__item" id="r8tgng_101"><p>Defines which table to scan.</p></li></ul></li><li class="list__item" id="r8tgng_97"><p><span class="control" id="r8tgng_102">Scan the Table:</span></p><ul class="list _bullet" id="r8tgng_103"><li class="list__item" id="r8tgng_104"><p>Uses <code class="code" id="r8tgng_105">ScanCommand</code> to retrieve all items from the table.</p></li></ul></li><li class="list__item" id="r8tgng_98"><p><span class="control" id="r8tgng_106">Handle the Response:</span></p><ul class="list _bullet" id="r8tgng_107"><li class="list__item" id="r8tgng_108"><p>On success, returns a <code class="code" id="r8tgng_110">200</code> status code with the items.</p></li><li class="list__item" id="r8tgng_109"><p>On failure, logs the error and returns a <code class="code" id="r8tgng_111">500</code> status code.</p></li></ul></li></ul></li></ul></section></section></section><section class="chapter"><h2 id="adding-gettodos-to-the-cdk-stack" data-toc="adding-gettodos-to-the-cdk-stack">‚ûï Adding <code class="code" id="r8tgng_117">getTodos</code> to the CDK Stack</h2><p id="r8tgng_113">Now, we'll add the <code class="code" id="r8tgng_118">getTodos</code> Lambda function to our AWS CDK stack and integrate it with API Gateway.</p><section class="chapter"><h3 id="1-define-the-gettodos-lambda-function-in-the-stack" data-toc="1-define-the-gettodos-lambda-function-in-the-stack">1. <span class="control" id="r8tgng_121">Define the <code class="code" id="r8tgng_122">getTodos</code> Lambda Function in the Stack</span></h3><ul class="list _bullet" id="r8tgng_120"><li class="list__item" id="r8tgng_123"><p id="r8tgng_125"><span class="control" id="r8tgng_126">Open your stack file (<code class="code" id="r8tgng_127">lib/serverless-app-stack.ts</code>).</span></p></li><li class="list__item" id="r8tgng_124"><p id="r8tgng_128"><span class="control" id="r8tgng_130">Add the following code:</span></p><div class="code-block" data-lang="ts">
// Define the getTodos Lambda Function
const getTodosFunction = new NodejsFunction(this, 'GetTodosFunction', {
  entry: path.join(__dirname, '../lambda/getTodos.ts'), // Path to your Lambda function code
  handler: 'handler',
  environment: {
    TABLE_NAME: table.tableName,  // Passes the DynamoDB table name
    AWS_REGION: this.region,      // Passes the AWS region
  },
});
</div></li></ul></section><section class="chapter"><h3 id="2-grant-read-permissions-to-the-lambda-function" data-toc="2-grant-read-permissions-to-the-lambda-function">2. <span class="control" id="r8tgng_133">Grant Read Permissions to the Lambda Function</span></h3><ul class="list _bullet" id="r8tgng_132"><li class="list__item" id="r8tgng_134"><p id="r8tgng_136"><span class="control" id="r8tgng_137">Why?</span> The function needs permission to read data from DynamoDB.</p></li><li class="list__item" id="r8tgng_135"><p id="r8tgng_138"><span class="control" id="r8tgng_140">How:</span></p><div class="code-block" data-lang="ts">
table.grantReadData(getTodosFunction);
</div></li></ul></section><section class="chapter"><h3 id="3-integrate-with-api-gateway" data-toc="3-integrate-with-api-gateway">3. <span class="control" id="r8tgng_144">Integrate with API Gateway</span></h3><ul class="list _bullet" id="r8tgng_142"><li class="list__item" id="r8tgng_145"><p id="r8tgng_147"><span class="control" id="r8tgng_148">Add a GET method to the <code class="code" id="r8tgng_149">/todos</code> resource to invoke <code class="code" id="r8tgng_150">getTodosFunction</code>.</span></p></li><li class="list__item" id="r8tgng_146"><p id="r8tgng_151"><span class="control" id="r8tgng_153">How:</span></p><div class="code-block" data-lang="ts">
// Integrate getTodos Lambda with GET method on /todos
const getTodosIntegration = new apigateway.LambdaIntegration(getTodosFunction);

todos.addMethod('GET', getTodosIntegration);  // GET /todos
</div></li></ul></section></section><section class="chapter"><h2 id="testing-and-deployment" data-toc="testing-and-deployment">üß™ Testing and Deployment</h2><section class="chapter"><h3 id="1-install-aws-sdk-v3-packages" data-toc="1-install-aws-sdk-v3-packages">1. <span class="control" id="r8tgng_160">Install AWS SDK v3 Packages</span></h3><ul class="list _bullet" id="r8tgng_159"><li class="list__item" id="r8tgng_161"><p id="r8tgng_163"><span class="control" id="r8tgng_164">Why?</span> Ensure the Lambda function has the necessary dependencies.</p></li><li class="list__item" id="r8tgng_162"><p id="r8tgng_165"><span class="control" id="r8tgng_168">How:</span></p><p id="r8tgng_166">In the root of your project, run:</p><div class="code-block" data-lang="bash">
npm install @aws-sdk/client-dynamodb @aws-sdk/lib-dynamodb
</div></li></ul></section><section class="chapter"><h3 id="2-synthesize-the-cloudformation-template" data-toc="2-synthesize-the-cloudformation-template">2. <span class="control" id="r8tgng_171">Synthesize the CloudFormation Template</span></h3><ul class="list _bullet" id="r8tgng_170"><li class="list__item" id="r8tgng_172"><p id="r8tgng_174"><span class="control" id="r8tgng_176">Command:</span></p><div class="code-block" data-lang="bash">
cdk synth
</div></li><li class="list__item" id="r8tgng_173"><p id="r8tgng_177"><span class="control" id="r8tgng_178">Purpose:</span> To verify the resources that will be created or updated.</p></li></ul></section><section class="chapter"><h3 id="3-deploy-the-stack" data-toc="3-deploy-the-stack">3. <span class="control" id="r8tgng_181">Deploy the Stack</span></h3><ul class="list _bullet" id="r8tgng_180"><li class="list__item" id="r8tgng_182"><p id="r8tgng_184"><span class="control" id="r8tgng_186">Command:</span></p><div class="code-block" data-lang="bash">
cdk deploy
</div></li><li class="list__item" id="r8tgng_183"><p id="r8tgng_187"><span class="control" id="r8tgng_188">Note:</span> Confirm the deployment when prompted.</p></li></ul></section><section class="chapter"><h3 id="4-testing-the-get-endpoint" data-toc="4-testing-the-get-endpoint">4. <span class="control" id="r8tgng_193">Testing the GET Endpoint</span></h3><section class="chapter"><h4 id="a-find-your-api-s-url" data-toc="a-find-your-api-s-url">a. <span class="control" id="r8tgng_196">Find Your API's URL</span></h4><ul class="list _bullet" id="r8tgng_195"><li class="list__item" id="r8tgng_197"><p><span class="control" id="r8tgng_198">Where to look:</span> The <code class="code" id="r8tgng_199">cdk deploy</code> output or in the AWS Console under API Gateway.</p></li></ul></section><section class="chapter"><h4 id="b-send-a-get-request" data-toc="b-send-a-get-request">b. <span class="control" id="r8tgng_202">Send a GET Request</span></h4><ul class="list _bullet" id="r8tgng_201"><li class="list__item" id="r8tgng_203"><p id="r8tgng_206"><span class="control" id="r8tgng_208">Use Tools Like:</span></p><ul class="list _bullet" id="r8tgng_207"><li class="list__item" id="r8tgng_209"><p><span class="control" id="r8tgng_211">Postman</span></p></li><li class="list__item" id="r8tgng_210"><p><span class="control" id="r8tgng_212">curl</span></p></li></ul></li><li class="list__item" id="r8tgng_204"><p id="r8tgng_213"><span class="control" id="r8tgng_215">Sample Request Using <code class="code" id="r8tgng_216">curl</code>:</span></p><div class="code-block" data-lang="bash">
curl https://your-api-id.execute-api.your-region.amazonaws.com/prod/todos
</div></li><li class="list__item" id="r8tgng_205"><p id="r8tgng_217"><span class="control" id="r8tgng_219">Expected Response:</span></p><ul class="list _bullet" id="r8tgng_218"><li class="list__item" id="r8tgng_220"><p>A list of todo items in JSON format.</p></li></ul></li></ul></section><section class="chapter"><h4 id="c-verify-the-data" data-toc="c-verify-the-data">c. <span class="control" id="r8tgng_224">Verify the Data</span></h4><ul class="list _bullet" id="r8tgng_222"><li class="list__item" id="r8tgng_225"><p><span class="control" id="r8tgng_226">Check in DynamoDB:</span> Ensure the items retrieved match those in your <code class="code" id="r8tgng_227">TodoTable</code>.</p></li></ul></section></section></section><section class="chapter"><h2 id="congratulations" data-toc="congratulations">üéâ Congratulations!</h2><p id="r8tgng_228"><span class="control" id="r8tgng_231">You've successfully added the <code class="code" id="r8tgng_232">getTodos</code> functionality to your serverless application!</span></p><ul class="list _bullet" id="r8tgng_229"><li class="list__item" id="r8tgng_233"><p><span class="control" id="r8tgng_234">What this means:</span></p><ul class="list _bullet" id="r8tgng_235"><li class="list__item" id="r8tgng_236"><p>Clients can now retrieve all todo items via an HTTP GET request.</p></li><li class="list__item" id="r8tgng_237"><p>Your application now supports both creating and reading todo items.</p></li></ul></li></ul></section><section class="chapter"><h2 id="additional-resources" data-toc="additional-resources">üìö Additional Resources</h2><ul class="list _bullet" id="r8tgng_238"><li class="list__item" id="r8tgng_239"><p><span class="control" id="r8tgng_245">AWS SDK for JavaScript v3 Documentation</span></p><ul class="list _bullet" id="r8tgng_246"><li class="list__item" id="r8tgng_247"><p><a href="https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/welcome.html" id="r8tgng_248" data-external="true" rel="noopener noreferrer">AWS SDK v3 Guide</a></p></li></ul></li><li class="list__item" id="r8tgng_240"><p><span class="control" id="r8tgng_249">AWS CDK Documentation</span></p><ul class="list _bullet" id="r8tgng_250"><li class="list__item" id="r8tgng_251"><p><a href="https://docs.aws.amazon.com/cdk/latest/guide/home.html" id="r8tgng_252" data-external="true" rel="noopener noreferrer">AWS CDK Guide</a></p></li></ul></li><li class="list__item" id="r8tgng_241"><p><span class="control" id="r8tgng_253">Amazon DynamoDB Documentation</span></p><ul class="list _bullet" id="r8tgng_254"><li class="list__item" id="r8tgng_255"><p><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Introduction.html" id="r8tgng_256" data-external="true" rel="noopener noreferrer">DynamoDB Introduction</a></p></li></ul></li><li class="list__item" id="r8tgng_242"><p><span class="control" id="r8tgng_257">AWS Lambda Documentation</span></p><ul class="list _bullet" id="r8tgng_258"><li class="list__item" id="r8tgng_259"><p><a href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" id="r8tgng_260" data-external="true" rel="noopener noreferrer">AWS Lambda Developer Guide</a></p></li></ul></li><li class="list__item" id="r8tgng_243"><p><span class="control" id="r8tgng_261">Amazon API Gateway Documentation</span></p><ul class="list _bullet" id="r8tgng_262"><li class="list__item" id="r8tgng_263"><p><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/welcome.html" id="r8tgng_264" data-external="true" rel="noopener noreferrer">API Gateway Developer Guide</a></p></li></ul></li><li class="list__item" id="r8tgng_244"><p><span class="control" id="r8tgng_265">TypeScript Handbook</span></p><ul class="list _bullet" id="r8tgng_266"><li class="list__item" id="r8tgng_267"><p><a href="https://www.typescriptlang.org/docs/handbook/intro.html" id="r8tgng_268" data-external="true" rel="noopener noreferrer">TypeScript Documentation</a></p></li></ul></li></ul></section><div class="last-modified">Last modified: 09 November 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="recap.html" class="navigation-links__prev">üèóÔ∏è Complete CDK Code: `createTodo` Reference</a><a href="creating-retrievetodos.html" class="navigation-links__next">üîç Creating `getTodo`</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.js"></script></body></html>